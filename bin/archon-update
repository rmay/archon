#!/usr/bin/env bash

# Exit immediately if a command exits with a non-zero status
set -e

# Show logo
clear
cat <~/.local/share/archon/logo.txt

# Get the latest while trying to preserve any modifications
archon_path=~/.local/share/archon
git -C $archon_path pull --autostash
git -C $archon_path diff --check || git -C $archon_path reset --merge

# Run migrations
"$HOME/.local/share/archon/bin/archon-migrate"

# Update system packages
echo -e "\e[32m\nUpdate system packages\e[0m"
yay -Syu --noconfirm

# Offer to reboot if the kernel has been changed
if [ "$(uname -r | sed 's/-arch/\.arch/')" != "$(pacman -Q linux | awk '{print $2}')" ]; then
  gum confirm "Linux kernel has been updated. Reboot?" && sudo reboot now
fi